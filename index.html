<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">Santa's Infinite Gift Box | è–èª•è€äººçš„ç„¡é™ç¦®ç‰©ç›’</title>
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

    <style>
        :root {
            --xmas-red: #c30f16;
            --xmas-green: #2f5a28;
            --xmas-gold: #f8b229;
            --snow-white: #ffffff;
            --bg-dark: #1a0f0f;
            --card-bg: rgba(47, 90, 40, 0.85);
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-dark);
            background-image: url('https://www.transparenttextures.com/patterns/snow.png'), linear-gradient(to bottom, #0f1a2a, #3a1c1c);
            color: var(--snow-white);
            margin: 0;
            padding: 20px;
            text-align: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* èªè¨€åˆ‡æ›å™¨ */
        .lang-switcher { position: absolute; top: 15px; right: 15px; z-index: 10; }
        .lang-btn { background: rgba(0,0,0,0.5); border: 1px solid var(--xmas-gold); color: var(--xmas-gold); padding: 5px 10px; margin-left: 5px; cursor: pointer; border-radius: 5px; font-size: 0.9em; }
        .lang-btn.active { background: var(--xmas-gold); color: var(--bg-dark); font-weight: bold; }

        /* é›ªèŠ±å‹•ç•« */
        .snowflakes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
        .snowflake { position: absolute; color: #fff; font-size: 1em; opacity: 0.8; }

        h1 { font-family: 'Mountains of Christmas', cursive; font-size: 3em; margin-bottom: 10px; color: var(--xmas-gold); text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .santa-icon { font-size: 3em; display: block; margin-bottom: -10px; margin-top: 30px; }
        .subtitle { font-size: 1.1em; color: #e2e2e2; margin-bottom: 30px; font-style: italic; }

        .container { max-width: 600px; margin: 0 auto; position: relative; z-index: 1; }

        .card { background: var(--card-bg); border: 3px solid var(--xmas-red); border-radius: 20px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 16px rgba(0,0,0,0.6), inset 0 0 20px rgba(0,0,0,0.2); position: relative; overflow: hidden; }
        .card::before { content: 'â„ï¸'; position: absolute; top: 10px; left: 10px; opacity: 0.5; font-size: 1.5em; }
        .card::after { content: 'ğŸ'; position: absolute; bottom: 10px; right: 10px; opacity: 0.5; font-size: 1.5em; }

        .pot-display { font-family: 'Mountains of Christmas', cursive; font-size: 3em; font-weight: bold; color: var(--xmas-gold); text-shadow: 0 0 15px rgba(248, 178, 41, 0.6); margin: 15px 0; }
        .timer-display { font-size: 1.8em; font-weight: bold; font-family: monospace; background: rgba(195, 15, 22, 0.6); padding: 5px 15px; border-radius: 10px; display: inline-block; margin: 10px 0; }

        .btn { background: linear-gradient(to bottom, var(--xmas-red), #8a0b0f); color: var(--snow-white); border: 2px solid var(--xmas-gold); padding: 15px 30px; font-size: 1.3em; font-weight: bold; border-radius: 15px; cursor: pointer; width: 100%; transition: all 0.2s; box-shadow: 0 4px 0 #5c070a, 0 5px 10px rgba(0,0,0,0.4); text-shadow: 1px 1px 2px rgba(0,0,0,0.5); font-family: 'Mountains of Christmas', cursive; position: relative; z-index: 5; }
        .btn:hover { filter: brightness(1.1); transform: translateY(-2px); box-shadow: 0 6px 0 #5c070a, 0 7px 12px rgba(0,0,0,0.5); }
        .btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #5c070a, 0 3px 5px rgba(0,0,0,0.5); }
        .btn:disabled { background: #555; border-color: #333; cursor: not-allowed; box-shadow: none; transform: none; }
        
        .btn-leading {
            background: linear-gradient(to bottom, var(--xmas-green), #1a3816) !important;
            border-color: #4CAF50 !important;
            cursor: default !important;
        }
        
        .btn-outline { background: rgba(248, 178, 41, 0.2); border: 2px solid var(--xmas-gold); color: var(--xmas-gold); margin-top: 15px; }
        .btn-outline:hover { background: rgba(248, 178, 41, 0.4); }

        .btn-sm { padding: 5px 10px; font-size: 0.9em; width: auto; display: inline-block; margin-left: 10px; background: #334155; border: 1px solid #aaa; color: white; cursor: pointer; border-radius: 5px; }

        .leader-display {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--xmas-gold);
            border-radius: 10px;
            padding: 10px;
            margin: 15px 0;
            font-family: monospace;
            color: #ddd;
        }
        .leader-address {
            color: var(--xmas-gold);
            font-weight: bold;
            font-size: 1.1em;
        }

        .history-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9em; }
        .history-table th { border-bottom: 2px solid var(--xmas-gold); padding: 8px; color: var(--xmas-gold); font-size: 0.85em; }
        .history-table td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); vertical-align: middle; }
        .winner-tag { background: var(--xmas-gold); color: #000; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; font-weight: bold; white-space: nowrap; }
        .protocol-tag { background: var(--xmas-green); color: #fff; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; white-space: nowrap; }

        .legacy-box { background: rgba(0,0,0,0.4); border: 1px dashed var(--xmas-gold); padding: 10px; margin-top: 15px; border-radius: 8px; text-align: left; }
        .legacy-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; padding: 5px 0; border-bottom: 1px solid #333; font-size: 0.9em; }

        .rules-container details { background: rgba(0,0,0,0.3); border-radius: 15px; padding: 15px; margin-bottom: 20px; text-align: left; border: 2px dashed var(--xmas-gold); }
        .rules-container summary { font-weight: bold; cursor: pointer; color: var(--xmas-gold); font-size: 1.1em; outline: none; }
        .rules-content { margin-top: 15px; line-height: 1.6; font-size: 0.95em; }
        .rules-content li { margin-bottom: 8px; }
        .highlight { color: var(--xmas-gold); font-weight: bold; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: left; margin-top: 15px; }
        .stat-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .stat-label { font-size: 0.9em; color: #bbb; }
        .stat-value { font-size: 1.2em; font-weight: bold; color: var(--snow-white); }

        #wallet-address { font-family: monospace; background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 20px; font-size: 0.9em; display: inline-block; margin-bottom: 20px; border: 1px solid var(--xmas-gold); }
        .hidden { display: none; }
        
        .protocol-active { border: 4px solid var(--xmas-gold); animation: glow 2s infinite alternate; background: linear-gradient(to bottom, #c30f16, #8a0b0f); }
        
        .footer-links { margin-top: 30px; font-size: 0.85em; color: #aaa; line-height: 1.8; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; }
        .footer-links a { color: var(--xmas-gold); text-decoration: none; border-bottom: 1px dotted var(--xmas-gold); transition: all 0.2s; }
        .footer-links a:hover { color: #fff; border-bottom-style: solid; }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>

<div class="lang-switcher">
    <button class="lang-btn" onclick="changeLanguage('en')" id="btn-en">EN</button>
    <button class="lang-btn active" onclick="changeLanguage('zh')" id="btn-zh">ä¸­æ–‡</button>
    <button class="lang-btn" onclick="changeLanguage('ja')" id="btn-ja">æ—¥æœ¬èª</button>
    <button class="lang-btn" onclick="changeLanguage('ko')" id="btn-ko">í•œêµ­ì–´</button>
</div>

<div class="snowflakes" aria-hidden="true">
  <div class="snowflake" style="left: 10%; animation: snowfall 10s linear infinite;">â„</div>
  <div class="snowflake" style="left: 30%; animation: snowfall 12s linear infinite, snowfall-shake 4s ease-in-out infinite;">â…</div>
  <div class="snowflake" style="left: 50%; animation: snowfall 8s linear infinite;">â†</div>
  <div class="snowflake" style="left: 70%; animation: snowfall 14s linear infinite, snowfall-shake 5s ease-in-out infinite;">â„</div>
  <div class="snowflake" style="left: 90%; animation: snowfall 11s linear infinite;">â…</div>
</div>
<style>
@keyframes snowfall { 0% { transform: translateY(-10vh); } 100% { transform: translateY(100vh); } }
@keyframes snowfall-shake { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(20px); } }
</style>

<div class="container">
    <span class="santa-icon">ğŸ…</span>
    <h1 data-i18n="mainTitle">è–èª•è€äººçš„ç„¡é™ç¦®ç‰©ç›’</h1>
    <div class="subtitle" data-i18n="subtitle">"Ho Ho Ho! èª°èƒ½æˆç‚ºä»Šå¹´æœ€å¹¸é‹çš„å­©å­ï¼Ÿ" - Powered by Cronos</div>

    <button id="connect-btn" class="btn" onclick="connectWallet()" data-i18n="connectBtn">ğŸ„ é€£çµéŒ¢åŒ…ï¼Œé ˜å–é©šå–œ (Connect)</button>
    <div id="wallet-info" class="hidden">
        <span id="wallet-address">Not Connected</span>
    </div>

    <div class="rules-container">
        <details>
            <summary data-i18n="rulesSummary">ğŸ“œ ä¾†è‡ªè–èª•è€äººçš„éŠæˆ²èªªæ˜æ›¸ (é»æ“Šå±•é–‹)</summary>
            <div class="rules-content">
                <p data-i18n="rulesIntro">æ­¡è¿ä¾†åˆ°åŒ—æ¥µæœ€åˆºæ¿€çš„ç¦®ç‰©çˆ­å¥ªæˆ°ï¼è¦å‰‡å¾ˆç°¡å–®ï¼Œä½†å……æ»¿é©šå–œï¼š</p>
                <ul>
                    <li data-i18n="rule1">ğŸ <b>å…¥å ´è²»ï¼š</b> æ¯æ¬¡è¨±é¡˜æŠ•å…¥ <span class="highlight">20 CRO</span>ã€‚</li>
                    <li data-i18n="rule2">ğŸ’° <b>è³‡é‡‘å»å‘ï¼š</b> 80% é€²å…¥é€™å€‹å·¨å¤§çš„ç¦®ç‰©ç›’(çæ± )ï¼Œ10% ç«‹å³åˆ†çµ¦ä¹‹å‰çš„åƒèˆ‡è€…ï¼Œ10% ç”±è–èª•è€äººä¿ç®¡(é–‹ç™¼èˆ‡é»‘æ´)ã€‚</li>
                    <li data-i18n="rule3">â³ <b>ç”Ÿå­˜æ³•å‰‡ï¼š</b> æˆç‚ºæœ€å¾Œä¸€å€‹è¨±é¡˜çš„äººï¼Œç•¶å€’æ•¸è¨ˆæ™‚æ­¸é›¶ï¼Œä½ å°±èƒ½ç¨å¾—ç¦®ç‰©ç›’è£¡çš„ <span class="highlight">80% å¤§ç</span>ï¼</li>
                    <li data-i18n="rule4">ğŸ¤ <b>äººäººæœ‰çï¼š</b> è¶Šæ—©åƒèˆ‡ï¼Œä½ å°±èƒ½åˆ†åˆ°è¶Šå¤šå¾Œä¾†è€…çš„å…¥å ´è²»(åˆ†ç´…)ï¼Œéš¨æ™‚å¯æé ˜ï¼</li>
                    <li data-i18n="rule5">ğŸ„ <b>è–èª•çµ‚æ¥µé©šå–œï¼š</b> å¦‚æœåˆ° <span class="highlight">12æœˆ26æ—¥ (UTC 12:00)</span> éŠæˆ²é‚„æ²’çµæŸï¼Œè–èª•è€äººæœƒå¼·åˆ¶æ‰“é–‹ç¦®ç‰©ç›’ï¼Œå°‡ <span class="highlight">50% çš„çé‡‘å¹³åˆ†</span>çµ¦æ‰€æœ‰è¨±éé¡˜çš„å¥½å­©å­ï¼</li>
                </ul>
                <p style="text-align: center; margin-top: 10px;"><i data-i18n="ruleFooter">"è¨˜å¾—ï¼Œæ¯æ¬¡è¨±é¡˜å¾Œè¦ä¼‘æ¯ 35 ç§’å–”ï¼"</i></p>
            </div>
        </details>
    </div>

    <div class="card" id="game-card">
        <div class="stat-label" style="color: var(--xmas-gold);" data-i18n="labelPot">ğŸ ç•¶å‰ç´¯ç©ç¦®ç‰©ç›’ (Grand Prize Pot)</div>
        <div class="pot-display" id="grand-pot">0.0 CRO</div>
        
        <hr style="border-color: rgba(255,255,255,0.2); opacity: 0.5;">
        
        <div class="leader-display">
            <div style="font-size:0.9em; margin-bottom:5px;" data-i18n="labelLeader">ğŸ‘‘ ç›®å‰æ½›åœ¨å¾—ä¸» (Current Leader)</div>
            <div class="leader-address" id="current-leader">Loading...</div>
        </div>

        <div id="timer-section">
            <div class="stat-label" data-i18n="labelTimer">â° è·é›¢é–‹çå‰©ä¸‹ (Time Remaining)</div>
            <div class="timer-display" id="timer">Loading...</div>
        </div>

        <div id="warmup-section" class="hidden">
            <div class="stat-label" data-i18n="labelWarmup">ğŸ”¥ è–èª•é›†æ°£ä¸­ (Warm-up Phase)</div>
            <div class="timer-display" style="background: var(--xmas-gold); color: var(--bg-dark);">
                <span id="warmup-count">0</span> / 100
            </div>
            <small style="color: #ddd;" data-i18n="warmupHint">ğŸ…ï¼šé›†æ»¿ 100 å€‹é¡˜æœ›ï¼Œå€’æ•¸è¨ˆæ™‚æ‰æœƒé–‹å§‹å–”ï¼ç¾åœ¨æ˜¯ç´¯ç©çé‡‘çš„å¥½æ™‚æ©Ÿï¼</small>
        </div>

        <button id="wish-btn" class="btn" style="margin-top: 25px;" onclick="makeWish()" data-i18n="wishBtn">
            âœ¨ æˆ‘è¦è¨±é¡˜ (æŠ•å…¥ 20 CRO)
        </button>
        <div style="margin-top: 10px; font-size: 0.85em; color: #ccc;" data-i18n="wishCooldownHint">
            *è–èª•è€äººæé†’ï¼šæ¯æ¬¡è¨±é¡˜æœ‰ 35 ç§’å†·å»æ™‚é–“
        </div>
    </div>

    <div class="card hidden" id="protocol-card" style="border-color: var(--xmas-gold); background: rgba(50, 40, 10, 0.85);">
        <div class="stat-label" style="color: var(--xmas-gold);" data-i18n="labelProtocol">ğŸ„ è–èª•å”è­°å¼·åˆ¶çµç®—å€’æ•¸ (Christmas Protocol)</div>
        <div class="timer-display" id="protocol-timer" style="background: var(--xmas-gold); color: var(--bg-dark); font-size: 1.5em;">Loading...</div>
        
        <div id="protocol-action-area" class="hidden" style="margin-top: 15px;">
            <p style="color: #ff4444; font-weight: bold; animation: pulse 1s infinite;">âš ï¸ æ™‚é–“å·²åˆ°ï¼å¿…é ˆå…ˆç”±ä¸€äººåŸ·è¡Œè§¸ç™¼ (Trigger First)</p>
            <button class="btn" onclick="triggerProtocol()" style="background: linear-gradient(to bottom, #ff0000, #990000); border: 2px solid white;">
                ğŸ… æ­¥é©Ÿä¸€ï¼šé–‹å•Ÿè–èª•å”è­° (åªéœ€ä¸€äººé»æ“Š)
            </button>
        </div>

        <div style="font-size: 0.8em; color: #ccc; margin-top:10px;" data-i18n="labelProtocolDesc">å¦‚æœéŠæˆ²æœªçµæŸï¼Œè–èª•è€äººå°‡åœ¨ 12/26 UTC 12:00 å¼·åˆ¶å¹³åˆ†çé‡‘ï¼</div>
    </div>

    <div class="card hidden protocol-active" id="christmas-card">
        <h2 style="color: var(--xmas-gold); margin-top: 0; font-family: 'Mountains of Christmas', cursive;" data-i18n="xmasTitle">ğŸ„ è–èª•å¿«æ¨‚ï¼é©šå–œæ™‚åˆ»ï¼</h2>
        <p style="font-size: 1.1em;" data-i18n="xmasDesc">è–èª•è€äººå¼·åˆ¶æ‰“é–‹äº†ç¦®ç‰©ç›’ï¼æ‰€æœ‰åƒèˆ‡è€…äººäººæœ‰çï¼</p>
        <p data-i18n="xmasYourGift">æ‚¨çš„å°ˆå±¬è–èª•ç´…åŒ…ï¼š</p>
        <div class="stat-value" id="christmas-gift-amount" style="font-size: 2em; margin-bottom: 20px; color: var(--snow-white); text-shadow: 0 0 10px var(--xmas-gold);">0.0 CRO</div>
        
        <button class="btn" style="background: linear-gradient(to bottom, var(--xmas-gold), #c37c0f); border: none; color: var(--bg-dark); font-size: 1.5em;" onclick="claimChristmas()" data-i18n="claimXmasBtn">
            ğŸ æ­¥é©ŸäºŒï¼šç«‹å³æ‹†é–‹ç´…åŒ… (äººäººæœ‰ç)
        </button>
    </div>

    <div class="card hidden" id="dashboard" style="border-color: var(--xmas-gold);">
        <div style="text-align: left; font-weight: bold; margin-bottom: 10px; color: var(--xmas-gold); font-size: 1.2em;" data-i18n="labelDashboard">ğŸ§¦ æˆ‘çš„è–èª•è¥ª (My Earnings)</div>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label" data-i18n="labelMyWishes">æˆ‘è¨±ä¸‹çš„é¡˜æœ›</div>
                <div class="stat-value" id="my-wishes">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label" data-i18n="labelMyDividends">è¥ªå­è£¡çš„åˆ†ç´… (CRO)</div>
                <div class="stat-value" id="my-dividends" style="color: var(--xmas-gold);">0.0</div>
            </div>
        </div>
        <button class="btn btn-outline" onclick="withdraw()" id="withdraw-btn" data-i18n="withdrawBtn">ğŸ’° å°‡åˆ†ç´…æ”¾å…¥å£è¢‹ (Claim)</button>

        <div id="legacy-claims" class="hidden"></div>
    </div>

    <div class="card hidden" id="history-card">
        <div style="text-align: left; font-weight: bold; margin-bottom: 10px; color: var(--xmas-gold);" data-i18n="labelHistory">ğŸ“œ æ­·å±†æ¦®è­½æ¦œ (History)</div>
        <table class="history-table">
            <thead>
                <tr>
                    <th data-i18n="thRound">å›åˆ</th>
                    <th data-i18n="thWinner">è´å®¶</th>
                    <th data-i18n="thWishes">é¡˜æœ›æ•¸</th>
                    <th data-i18n="thPrize">ç¨å¾—çé‡‘</th>
                </tr>
            </thead>
            <tbody id="history-list">
                <tr><td colspan="4" style="text-align:center; color:#888;">Loading history...</td></tr>
            </tbody>
        </table>
    </div>

    <div class="footer-links">
        <div>
            <span data-i18n="labelContract">Verified Contract:</span>
            <a href="#" id="contract-link" target="_blank" data-i18n="linkContract">View on CronosScan</a>
        </div>
        <div style="margin-top: 8px;">
            <span data-i18n="labelWhitepaper">Whitepaper:</span>
            <a href="https://santa-cro.gitbook.io/santa.cro-docs/" target="_blank" data-i18n="linkWhitepaper">Read Docs</a>
        </div>
    </div>
</div>

<script>
    console.log("Script loaded successfully. Ethers version:", typeof ethers !== 'undefined' ? ethers.version : 'Not loaded');

    // --- Internationalization (i18n) ---
    const translations = {
        zh: {
            pageTitle: "Santa's Infinite Gift Box | è–èª•è€äººçš„ç„¡é™ç¦®ç‰©ç›’",
            mainTitle: "è–èª•è€äººçš„ç„¡é™ç¦®ç‰©ç›’",
            subtitle: "\"Ho Ho Ho! èª°èƒ½æˆç‚ºä»Šå¹´æœ€å¹¸é‹çš„å­©å­ï¼Ÿ\" - Powered by Cronos",
            connectBtn: "ğŸ„ é€£çµéŒ¢åŒ…ï¼Œé ˜å–é©šå–œ (Connect)",
            rulesSummary: "ğŸ“œ ä¾†è‡ªè–èª•è€äººçš„éŠæˆ²èªªæ˜æ›¸ (é»æ“Šå±•é–‹)",
            rulesIntro: "æ­¡è¿ä¾†åˆ°åŒ—æ¥µæœ€åˆºæ¿€çš„ç¦®ç‰©çˆ­å¥ªæˆ°ï¼è¦å‰‡å¾ˆç°¡å–®ï¼Œä½†å……æ»¿é©šå–œï¼š",
            rule1: "ğŸ <b>å…¥å ´è²»ï¼š</b> æ¯æ¬¡è¨±é¡˜æŠ•å…¥ <span class='highlight'>20 CRO</span>ã€‚",
            rule2: "ğŸ’° <b>è³‡é‡‘å»å‘ï¼š</b> 80% é€²å…¥é€™å€‹å·¨å¤§çš„ç¦®ç‰©ç›’(çæ± )ï¼Œ10% ç«‹å³åˆ†çµ¦ä¹‹å‰çš„åƒèˆ‡è€…ï¼Œ10% ç”±è–èª•è€äººä¿ç®¡(é–‹ç™¼èˆ‡é»‘æ´)ã€‚",
            rule3: "â³ <b>ç”Ÿå­˜æ³•å‰‡ï¼š</b> æˆç‚ºæœ€å¾Œä¸€å€‹è¨±é¡˜çš„äººï¼Œç•¶å€’æ•¸è¨ˆæ™‚æ­¸é›¶ï¼Œä½ å°±èƒ½ç¨å¾—ç¦®ç‰©ç›’è£¡çš„ <span class='highlight'>80% å¤§ç</span>ï¼",
            rule4: "ğŸ¤ <b>äººäººæœ‰çï¼š</b> è¶Šæ—©åƒèˆ‡ï¼Œä½ å°±èƒ½åˆ†åˆ°è¶Šå¤šå¾Œä¾†è€…çš„å…¥å ´è²»(åˆ†ç´…)ï¼Œéš¨æ™‚å¯æé ˜ï¼",
            rule5: "ğŸ„ <b>è–èª•çµ‚æ¥µé©šå–œï¼š</b> å¦‚æœåˆ° <span class='highlight'>12æœˆ26æ—¥ (UTC 12:00)</span> éŠæˆ²é‚„æ²’çµæŸï¼Œè–èª•è€äººæœƒå¼·åˆ¶æ‰“é–‹ç¦®ç‰©ç›’ï¼Œå°‡ <span class='highlight'>50% çš„çé‡‘å¹³åˆ†</span>çµ¦æ‰€æœ‰è¨±éé¡˜çš„å¥½å­©å­ï¼",
            ruleFooter: "\"è¨˜å¾—ï¼Œæ¯æ¬¡è¨±é¡˜å¾Œè¦ä¼‘æ¯ 35 ç§’å–”ï¼\"",
            labelPot: "ğŸ ç•¶å‰ç´¯ç©ç¦®ç‰©ç›’ (Grand Prize Pot)",
            labelLeader: "ğŸ‘‘ ç›®å‰æ½›åœ¨å¾—ä¸» (Current Leader)",
            labelTimer: "â° è·é›¢é–‹çå‰©ä¸‹ (Time Remaining)",
            labelWarmup: "ğŸ”¥ è–èª•é›†æ°£ä¸­ (Warm-up Phase)",
            warmupHint: "ğŸ…ï¼šé›†æ»¿ 100 å€‹é¡˜æœ›ï¼Œå€’æ•¸è¨ˆæ™‚æ‰æœƒé–‹å§‹å–”ï¼ç¾åœ¨æ˜¯ç´¯ç©çé‡‘çš„å¥½æ™‚æ©Ÿï¼",
            wishBtn: "âœ¨ æˆ‘è¦è¨±é¡˜ (æŠ•å…¥ 20 CRO)",
            btnYouAreLeading: "ğŸ† ä½ ç›®å‰æ˜¯é ˜å…ˆè€… (Leading)",
            wishCooldownHint: "*è–èª•è€äººæé†’ï¼šæ¯æ¬¡è¨±é¡˜æœ‰ 35 ç§’å†·å»æ™‚é–“",
            labelDashboard: "ğŸ§¦ æˆ‘çš„è–èª•è¥ª (My Earnings)",
            labelMyWishes: "æˆ‘è¨±ä¸‹çš„é¡˜æœ›",
            labelMyDividends: "è¥ªå­è£¡çš„åˆ†ç´… (CRO)",
            withdrawBtn: "ğŸ’° å°‡åˆ†ç´…æ”¾å…¥å£è¢‹ (Claim)",
            xmasTitle: "ğŸ„ è–èª•å¿«æ¨‚ï¼é©šå–œæ™‚åˆ»ï¼",
            xmasDesc: "è–èª•è€äººå¼·åˆ¶æ‰“é–‹äº†ç¦®ç‰©ç›’ï¼æ‰€æœ‰åƒèˆ‡è€…äººäººæœ‰çï¼",
            xmasYourGift: "æ‚¨çš„å°ˆå±¬è–èª•ç´…åŒ…ï¼š",
            claimXmasBtn: "ğŸ æ­¥é©ŸäºŒï¼šç«‹å³æ‹†é–‹ç´…åŒ… (äººäººæœ‰ç)",
            labelProtocol: "ğŸ„ è–èª•å”è­°å¼·åˆ¶çµç®—å€’æ•¸",
            labelProtocolDesc: "å¦‚æœéŠæˆ²æœªçµæŸï¼Œè–èª•è€äººå°‡åœ¨ 12/26 UTC 12:00 å¼·åˆ¶å¹³åˆ†çé‡‘ï¼",
            labelHistory: "ğŸ“œ æ­·å±†æ¦®è­½æ¦œ (History)",
            thRound: "å›åˆ",
            thWinner: "è´å®¶",
            thWishes: "é¡˜æœ›æ•¸",
            thPrize: "ç¨å¾—çé‡‘(Won)",
            tagWinner: "å¤§ç",
            tagProtocol: "è–èª•å”è­°",
            noHistory: "æš«ç„¡ç´€éŒ„",
            labelContract: "åˆç´„åœ°å€:",
            linkContract: "åœ¨ CronosScan ä¸ŠæŸ¥çœ‹",
            labelWhitepaper: "é …ç›®ç™½çš®æ›¸:",
            linkWhitepaper: "é–±è®€å®Œæ•´æ–‡ä»¶",
            alertNoWallet: "Ho Ho Ho! è–èª•è€äººæ‰¾ä¸åˆ°æ‚¨çš„éŒ¢åŒ…ï¼Œè«‹å®‰è£ MetaMaskï¼",
            alertWrongChain: "è«‹åˆ‡æ›åˆ° Cronos ä¸»ç¶²ä¾†åƒèˆ‡è–èª•æ´»å‹•å–”ï¼",
            timerCalculating: "00:00:00 (è–èª•è€äººçµç®—ä¸­...)",
            btnWishing: "ğŸ… è–èª•è€äººç¢ºèªä¸­...",
            alertWishSuccess: "Ho Ho Ho! è¨±é¡˜æˆåŠŸï¼ç¥ä½ æˆç‚ºæœ€å¹¸é‹çš„å­©å­ï¼",
            alertWishFail: "è¨±é¡˜å¤±æ•—ï¼š",
            alertCooldown: "è–èª•è€äººèªªï¼šè«‹å†ç­‰ä¸€ä¸‹ (å†·å»ä¸­)!",
            btnWithdrawing: "æ‰“åŒ…ä¸­...",
            alertWithdrawSuccess: "ğŸ’° å®å®å™¹ï¼åˆ†ç´…å·²ç¶“æ”¾å…¥ä½ çš„éŒ¢åŒ…å›‰ï¼",
            alertWithdrawFail: "æé ˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦",
            btnClaimingXmas: "æ‹†ç¦®ç‰©ä¸­...",
            alertClaimXmasSuccess: "ğŸ„ è–èª•å¿«æ¨‚ï¼å¤§ç´…åŒ…å·²ç¶“é€é”ï¼",
            htmlClaimXmasDone: "<h2 style='color:var(--xmas-gold)'>âœ… ç¦®ç‰©å·²æˆåŠŸé ˜å–ï¼è–èª•å¿«æ¨‚ï¼</h2>",
            alertClaimXmasFail: "é ˜å–å¤±æ•—ï¼Œæ˜¯ä¸æ˜¯å·²ç¶“é ˜éäº†å‘¢ï¼Ÿ",
            protocolReady: "ğŸ‰ è–èª•å”è­°æº–å‚™å°±ç·’ï¼",
            labelLegacy: "ğŸ´â€â˜ ï¸ éºå¿˜çš„å¯¶è— (Unclaimed)",
            btnClaimOld: "è£œé ˜"
        },
        en: {
            pageTitle: "Santa's Infinite Gift Box",
            mainTitle: "Santa's Infinite Gift Box",
            subtitle: "\"Ho Ho Ho! Who will be the luckiest child this year?\" - Powered by Cronos",
            connectBtn: "ğŸ„ Connect Wallet for Surprises",
            rulesSummary: "ğŸ“œ Santa's Game Rules (Click to Expand)",
            rulesIntro: "Welcome to the North Pole's most exciting gift battle! Simple rules, big surprises:",
            rule1: "ğŸ <b>Entry Fee:</b> Deposit <span class='highlight'>20 CRO</span> to make a wish.",
            rule2: "ğŸ’° <b>Allocation:</b> 80% goes to the Gift Box (Pot), 10% is instantly divided among earlier participants as dividends, 10% kept by Santa (Dev & Blackhole).",
            rule3: "â³ <b>Survival Rule:</b> Be the LAST one to wish. When the timer hits zero, you win <span class='highlight'>80% of the entire Gift Box</span>!",
            rule4: "ğŸ¤ <b>Everyone Wins:</b> The earlier you join, the more dividends you earn from later participants. Claim anytime!",
            rule5: "ğŸ„ <b>Ultimate Christmas Surprise:</b> If the game hasn't ended by <span class='highlight'>Dec 26 (UTC 12:00)</span>, Santa will force open the box and share <span class='highlight'>50% of the pot equally</span> among all who wished!",
            ruleFooter: "\"Remember, take a 35-second rest after each wish!\"",
            labelPot: "ğŸ Current Gift Box (Grand Prize Pot)",
            labelLeader: "ğŸ‘‘ Current Potential Winner",
            labelTimer: "â° Time Remaining",
            labelWarmup: "ğŸ”¥ Warm-up Phase",
            warmupHint: "ğŸ…: Countdown starts after 100 wishes gathered! Great time to build the pot!",
            wishBtn: "âœ¨ Make a Wish (Deposit 20 CRO)",
            btnYouAreLeading: "ğŸ† You are Winning (Leading)",
            wishCooldownHint: "*Santa's reminder: 35s cooldown after each wish",
            labelDashboard: "ğŸ§¦ My Christmas Stocking (Earnings)",
            labelMyWishes: "My Wishes Made",
            labelMyDividends: "Stocking Dividends (CRO)",
            withdrawBtn: "ğŸ’° Claim Dividends to Pocket",
            xmasTitle: "ğŸ„ Merry Christmas! Surprise Time!",
            xmasDesc: "Santa has forced the Gift Box open! Everyone gets a prize!",
            xmasYourGift: "Your Exclusive Christmas Red Envelope:",
            claimXmasBtn: "ğŸ Step 2: Open Gift Now",
            labelProtocol: "ğŸ„ Christmas Protocol Countdown",
            labelProtocolDesc: "If game not ended, Santa forces distribution on Dec 26, 12:00 UTC!",
            labelHistory: "ğŸ“œ Past Winners (History)",
            thRound: "Round",
            thWinner: "Winner",
            thWishes: "Wishes",
            thPrize: "Winner's Prize",
            tagWinner: "Jackpot",
            tagProtocol: "Protocol",
            noHistory: "No history yet",
            labelContract: "Verified Contract:",
            linkContract: "View on CronosScan",
            labelWhitepaper: "Whitepaper:",
            linkWhitepaper: "Read Docs",
            alertNoWallet: "Ho Ho Ho! Santa can't find your wallet. Please install MetaMask!",
            alertWrongChain: "Please switch to Cronos Mainnet to join the Christmas event!",
            timerCalculating: "00:00:00 (Santa is calculating...)",
            btnWishing: "ğŸ… Santa is checking list...",
            alertWishSuccess: "Ho Ho Ho! Wish granted! Good luck!",
            alertWishFail: "Wish failed: ",
            alertCooldown: "Santa says: Please wait a moment (Cooldown)!",
            btnWithdrawing: "Packing...",
            alertWithdrawSuccess: "ğŸ’° Jingle Bells! Dividends are in your wallet!",
            alertWithdrawFail: "Claim failed, please try again later.",
            btnClaimingXmas: "Opening gift...",
            alertClaimXmasSuccess: "ğŸ„ Merry Christmas! Big Red Envelope delivered!",
            htmlClaimXmasDone: "<h2 style='color:var(--xmas-gold)'>âœ… Gift Claimed! Merry Christmas!</h2>",
            alertClaimXmasFail: "Claim failed. Have you already opened it?",
            protocolReady: "ğŸ‰ Protocol Ready!",
            labelLegacy: "ğŸ´â€â˜ ï¸ Unclaimed History",
            btnClaimOld: "Claim"
        },
        ja: {
            pageTitle: "ã‚µãƒ³ã‚¿ã®ç„¡é™ã‚®ãƒ•ãƒˆãƒœãƒƒã‚¯ã‚¹",
            mainTitle: "ã‚µãƒ³ã‚¿ã®ç„¡é™ã‚®ãƒ•ãƒˆãƒœãƒƒã‚¯ã‚¹",
            subtitle: "ã€Œãƒ›ã‚¥ãƒ›ã‚¥ãƒ›ã‚¥ï¼ä»Šå¹´ä¸€ç•ªãƒ©ãƒƒã‚­ãƒ¼ãªå­ã¯èª°ã‹ãªï¼Ÿã€ - Powered by Cronos",
            connectBtn: "ğŸ„ ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ¥ç¶šã—ã¦ã‚µãƒ—ãƒ©ã‚¤ã‚ºã‚’å—ã‘å–ã‚‹",
            rulesSummary: "ğŸ“œ ã‚µãƒ³ã‚¿ã‹ã‚‰ã®ã‚²ãƒ¼ãƒ èª¬æ˜æ›¸ (ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹)",
            rulesIntro: "åŒ—æ¥µã§æœ€ã‚‚ã‚¨ã‚­ã‚µã‚¤ãƒ†ã‚£ãƒ³ã‚°ãªã‚®ãƒ•ãƒˆãƒãƒˆãƒ«ã¸ã‚ˆã†ã“ãï¼ãƒ«ãƒ¼ãƒ«ã¯ç°¡å˜ã€ã§ã‚‚ã‚µãƒ—ãƒ©ã‚¤ã‚ºãŒã„ã£ã±ã„ï¼š",
            rule1: "ğŸ <b>å‚åŠ è²»ï¼š</b> 1å›ã®é¡˜ã„äº‹ã« <span class='highlight'>20 CRO</span> ã‚’æŠ•å…¥ã€‚",
            rule2: "ğŸ’° <b>è³‡é‡‘ã®è¡Œæ–¹ï¼š</b> 80%ãŒå·¨å¤§ãªã‚®ãƒ•ãƒˆãƒœãƒƒã‚¯ã‚¹(è³é‡‘ãƒ—ãƒ¼ãƒ«)ã¸ã€10%ãŒä»¥å‰ã®å‚åŠ è€…ã¸ã®å³æ™‚é…å½“ã€10%ã¯ã‚µãƒ³ã‚¿ãŒç®¡ç†(é–‹ç™ºã¨ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«)ã€‚",
            rule3: "â³ <b>ã‚µãƒã‚¤ãƒãƒ«ãƒ»ãƒ«ãƒ¼ãƒ«ï¼š</b> æœ€å¾Œã«é¡˜ã„äº‹ã‚’ã—ãŸäººã«ãªã‚ã†ã€‚ã‚¿ã‚¤ãƒãƒ¼ãŒã‚¼ãƒ­ã«ãªã£ãŸæ™‚ã€ã‚®ãƒ•ãƒˆãƒœãƒƒã‚¯ã‚¹ã® <span class='highlight'>80%ã‚’ç‹¬ã‚Šå ã‚</span>ï¼",
            rule4: "ğŸ¤ <b>å…¨å“¡ã«ãƒãƒ£ãƒ³ã‚¹ï¼š</b> æ—©ãå‚åŠ ã™ã‚‹ã»ã©ã€å¾Œã‹ã‚‰æ¥ãŸäººã®å‚åŠ è²»ã‹ã‚‰å¤šãã®é…å½“ã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚ã„ã¤ã§ã‚‚å¼•ãå‡ºã—å¯èƒ½ï¼",
            rule5: "ğŸ„ <b>ç©¶æ¥µã®ã‚¯ãƒªã‚¹ãƒã‚¹ã‚µãƒ—ãƒ©ã‚¤ã‚ºï¼š</b> <span class='highlight'>12æœˆ26æ—¥ (UTC 12:00)</span> ã¾ã§ã«ã‚²ãƒ¼ãƒ ãŒçµ‚ã‚ã‚‰ãªã„å ´åˆã€ã‚µãƒ³ã‚¿ãŒå¼·åˆ¶çš„ã«ãƒœãƒƒã‚¯ã‚¹ã‚’é–‹ã‘ã€è³é‡‘ã® <span class='highlight'>50%ã‚’é¡˜ã„äº‹ã‚’ã—ãŸå…¨å“¡ã§å±±åˆ†ã‘</span>ã—ã¾ã™ï¼",
            ruleFooter: "ã€Œé¡˜ã„äº‹ã®å¾Œã¯35ç§’ä¼‘æ†©ã—ã¦ã­ï¼ã€",
            labelPot: "ğŸ ç¾åœ¨ã®ç´¯ç©ã‚®ãƒ•ãƒˆãƒœãƒƒã‚¯ã‚¹ (è³é‡‘ç·é¡)",
            labelLeader: "ğŸ‘‘ ç¾åœ¨ã®å‹è€…å€™è£œ",
            labelTimer: "â° æŠ½é¸ã¾ã§ã®æ®‹ã‚Šæ™‚é–“",
            labelWarmup: "ğŸ”¥ ã‚¯ãƒªã‚¹ãƒã‚¹æº–å‚™ä¸­ (ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—)",
            warmupHint: "ğŸ…ï¼š100å€‹ã®é¡˜ã„ãŒé›†ã¾ã£ãŸã‚‰ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹ã ã‚ˆï¼ä»ŠãŒè³é‡‘ã‚’è²¯ã‚ã‚‹ãƒãƒ£ãƒ³ã‚¹ï¼",
            wishBtn: "âœ¨ é¡˜ã„äº‹ã‚’ã™ã‚‹ (20 CRO æŠ•å…¥)",
            btnYouAreLeading: "ğŸ† ã‚ãªãŸãŒãƒªãƒ¼ãƒ‰ä¸­ï¼",
            wishCooldownHint: "*ã‚µãƒ³ã‚¿ã‹ã‚‰ã®ãƒ¡ãƒ¢ï¼šå„é¡˜ã„äº‹ã®å¾Œã«35ç§’ã®ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ãŒã‚ã‚Šã¾ã™",
            labelDashboard: "ğŸ§¦ ç§ã®ã‚¯ãƒªã‚¹ãƒã‚¹ã‚½ãƒƒã‚¯ã‚¹ (åç›Š)",
            labelMyWishes: "ç§ã®é¡˜ã„äº‹ã®æ•°",
            labelMyDividends: "ã‚½ãƒƒã‚¯ã‚¹ã®ä¸­ã®é…å½“ (CRO)",
            withdrawBtn: "ğŸ’° é…å½“ã‚’ãƒã‚±ãƒƒãƒˆã«å…¥ã‚Œã‚‹ (è«‹æ±‚)",
            xmasTitle: "ğŸ„ ãƒ¡ãƒªãƒ¼ã‚¯ãƒªã‚¹ãƒã‚¹ï¼ã‚µãƒ—ãƒ©ã‚¤ã‚ºã‚¿ã‚¤ãƒ ï¼",
            xmasDesc: "ã‚µãƒ³ã‚¿ãŒã‚®ãƒ•ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’å¼·åˆ¶ã‚ªãƒ¼ãƒ—ãƒ³ï¼å‚åŠ è€…å…¨å“¡ã«ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆï¼",
            xmasYourGift: "ã‚ãªãŸã®å°‚ç”¨ãŠå¹´ç‰ï¼š",
            claimXmasBtn: "ğŸ Step 2: ä»Šã™ããŠå¹´ç‰ã‚’é–‹ã‘ã‚‹",
            labelProtocol: "ğŸ„ ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ»ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ»ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³",
            labelProtocolDesc: "ã‚²ãƒ¼ãƒ ãŒç¶šã„ã¦ã„ã‚‹å ´åˆã€12/26 12:00 UTCã«ã‚µãƒ³ã‚¿ãŒå¼·åˆ¶é…å½“ã‚’è¡Œã„ã¾ã™ï¼",
            labelHistory: "ğŸ“œ éå»ã®å‹è€… (History)",
            thRound: "ãƒ©ã‚¦ãƒ³ãƒ‰",
            thWinner: "å‹è€…",
            thWishes: "é¡˜ã„äº‹ã®æ•°",
            thPrize: "ç²å¾—è³é‡‘",
            tagWinner: "å¤§å½“ãŸã‚Š",
            tagProtocol: "ãƒ—ãƒ­ãƒˆã‚³ãƒ«",
            noHistory: "è¨˜éŒ²ãªã—",
            labelContract: "ç¢ºèªæ¸ˆã¿ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ:",
            linkContract: "CronosScanã§è¦‹ã‚‹",
            labelWhitepaper: "ãƒ›ãƒ¯ã‚¤ãƒˆãƒšãƒ¼ãƒ‘ãƒ¼:",
            linkWhitepaper: "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€",
            alertNoWallet: "ãƒ›ã‚¥ãƒ›ã‚¥ãƒ›ã‚¥ï¼ã‚µãƒ³ã‚¿ãŒã‚ãªãŸã®ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã¾ã›ã‚“ã€‚MetaMaskã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ï¼",
            alertWrongChain: "ã‚¯ãƒªã‚¹ãƒã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã«å‚åŠ ã™ã‚‹ã«ã¯Cronosãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆã«åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„ï¼",
            timerCalculating: "00:00:00 (ã‚µãƒ³ã‚¿ãŒé›†è¨ˆä¸­...)",
            btnWishing: "ğŸ… ã‚µãƒ³ã‚¿ãŒãƒªã‚¹ãƒˆã‚’ç¢ºèªä¸­...",
            alertWishSuccess: "ãƒ›ã‚¥ãƒ›ã‚¥ãƒ›ã‚¥ï¼é¡˜ã„ãŒå¶ã„ã¾ã—ãŸï¼å¹¸é‹ã‚’ç¥ˆã‚‹ï¼",
            alertWishFail: "é¡˜ã„äº‹ãŒå¤±æ•—ã—ã¾ã—ãŸï¼š",
            alertCooldown: "ã‚µãƒ³ã‚¿ãŒè¨€ã£ã¦ã„ã¾ã™ï¼šã‚‚ã†å°‘ã—å¾…ã£ã¦ã­ï¼ˆã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ä¸­ï¼‰ï¼",
            btnWithdrawing: "æ¢±åŒ…ä¸­...",
            alertWithdrawSuccess: "ğŸ’° ã‚¸ãƒ³ã‚°ãƒ«ãƒ™ãƒ«ï¼é…å½“ãŒã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«å…¥ã‚Šã¾ã—ãŸï¼",
            alertWithdrawFail: "è«‹æ±‚ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",
            btnClaimingXmas: "ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’é–‹å°ä¸­...",
            alertClaimXmasSuccess: "ğŸ„ ãƒ¡ãƒªãƒ¼ã‚¯ãƒªã‚¹ãƒã‚¹ï¼å¤§ããªãŠå¹´ç‰ãŒå±Šãã¾ã—ãŸï¼",
            htmlClaimXmasDone: "<h2 style='color:var(--xmas-gold)'>âœ… ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’å—ã‘å–ã‚Šã¾ã—ãŸï¼ãƒ¡ãƒªãƒ¼ã‚¯ãƒªã‚¹ãƒã‚¹ï¼</h2>",
            alertClaimXmasFail: "å—ã‘å–ã‚Šã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ—¢ã«é–‹ã‘ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ",
            protocolReady: "ğŸ‰ ãƒ—ãƒ­ãƒˆã‚³ãƒ«æº–å‚™å®Œäº†ï¼",
            labelLegacy: "ğŸ´â€â˜ ï¸ æœªè«‹æ±‚ã®é…å½“ (Unclaimed)",
            btnClaimOld: "è«‹æ±‚"
        },
        ko: {
            pageTitle: "ì‚°íƒ€ì˜ ë¬´í•œ ì„ ë¬¼ ìƒì",
            mainTitle: "ì‚°íƒ€ì˜ ë¬´í•œ ì„ ë¬¼ ìƒì",
            subtitle: "\"í˜¸í˜¸í˜¸! ì˜¬í•´ ê°€ì¥ ìš´ ì¢‹ì€ ì•„ì´ëŠ” ëˆ„êµ¬ì¼ê¹Œ?\" - Powered by Cronos",
            connectBtn: "ğŸ„ ì§€ê°‘ ì—°ê²°í•˜ê³  ë†€ë¼ì›€ ë°›ê¸°",
            rulesSummary: "ğŸ“œ ì‚°íƒ€ì˜ ê²Œì„ ì„¤ëª…ì„œ (í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°)",
            rulesIntro: "ë¶ê·¹ì—ì„œ ê°€ì¥ í¥ë¯¸ì§„ì§„í•œ ì„ ë¬¼ ê²½ìŸì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ê·œì¹™ì€ ê°„ë‹¨í•˜ì§€ë§Œ ë†€ë¼ì›€ì´ ê°€ë“í•©ë‹ˆë‹¤:",
            rule1: "ğŸ <b>ì°¸ê°€ë¹„:</b> ì†Œì›ì„ ë¹Œ ë•Œë§ˆë‹¤ <span class='highlight'>20 CRO</span> íˆ¬ì….",
            rule2: "ğŸ’° <b>ìê¸ˆ íë¦„:</b> 80%ëŠ” ê±°ëŒ€í•œ ì„ ë¬¼ ìƒì(ìƒê¸ˆ í’€)ë¡œ, 10%ëŠ” ì´ì „ ì°¸ê°€ìë“¤ì—ê²Œ ì¦‰ì‹œ ë°°ë‹¹, 10%ëŠ” ì‚°íƒ€ê°€ ê´€ë¦¬(ê°œë°œ ë° ë¸”ë™í™€).",
            rule3: "â³ <b>ìƒì¡´ ê·œì¹™:</b> ë§ˆì§€ë§‰ìœ¼ë¡œ ì†Œì›ì„ ë¹ˆ ì‚¬ëŒì´ ë˜ì„¸ìš”. íƒ€ì´ë¨¸ê°€ 0ì´ ë˜ë©´ ì„ ë¬¼ ìƒìì˜ <span class='highlight'>80%ë¥¼ ë…ì°¨ì§€</span>í•©ë‹ˆë‹¤!",
            rule4: "ğŸ¤ <b>ëª¨ë‘ê°€ ìŠ¹ì:</b> ì¼ì° ì°¸ì—¬í• ìˆ˜ë¡ ë‚˜ì¤‘ì— ë“¤ì–´ì˜¤ëŠ” ì‚¬ëŒë“¤ì˜ ì°¸ê°€ë¹„ì—ì„œ ë” ë§ì€ ë°°ë‹¹ê¸ˆì„ ë°›ìŠµë‹ˆë‹¤. ì–¸ì œë“  ì¶œê¸ˆ ê°€ëŠ¥!",
            rule5: "ğŸ„ <b>ê¶ê·¹ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì„œí”„ë¼ì´ì¦ˆ:</b> <span class='highlight'>12ì›” 26ì¼ (UTC 12:00)</span>ê¹Œì§€ ê²Œì„ì´ ëë‚˜ì§€ ì•Šìœ¼ë©´, ì‚°íƒ€ê°€ ê°•ì œë¡œ ìƒìë¥¼ ì—´ì–´ ìƒê¸ˆì˜ <span class='highlight'>50%ë¥¼ ì†Œì›ì„ ë¹ˆ ëª¨ë“  ì‚¬ëŒì—ê²Œ ê· ë“±í•˜ê²Œ ë‚˜ëˆ•ë‹ˆë‹¤</span>!",
            ruleFooter: "\"ì†Œì›ì„ ë¹ˆ í›„ì—ëŠ” 35ì´ˆ ë™ì•ˆ íœ´ì‹í•´ì•¼ í•´ìš”!\"",
            labelPot: "ğŸ í˜„ì¬ ëˆ„ì  ì„ ë¬¼ ìƒì (ì´ ìƒê¸ˆ)",
            labelLeader: "ğŸ‘‘ í˜„ì¬ ì ì¬ì  ìš°ìŠ¹ì",
            labelTimer: "â° ì¶”ì²¨ê¹Œì§€ ë‚¨ì€ ì‹œê°„",
            labelWarmup: "ğŸ”¥ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì¤€ë¹„ ì¤‘ (ì›Œë°ì—…)",
            warmupHint: "ğŸ…: ì†Œì› 100ê°œê°€ ëª¨ì´ë©´ ì¹´ìš´íŠ¸ë‹¤ìš´ì´ ì‹œì‘ë©ë‹ˆë‹¤! ì§€ê¸ˆì´ ìƒê¸ˆì„ ëª¨ì„ ê¸°íšŒì…ë‹ˆë‹¤!",
            wishBtn: "âœ¨ ì†Œì› ë¹Œê¸° (20 CRO íˆ¬ì…)",
            btnYouAreLeading: "ğŸ† í˜„ì¬ ìš°ìŠ¹ í›„ë³´ì…ë‹ˆë‹¤",
            wishCooldownHint: "*ì‚°íƒ€ì˜ ë©”ëª¨: ê° ì†Œì› í›„ 35ì´ˆì˜ ì¿¨íƒ€ì„ì´ ìˆìŠµë‹ˆë‹¤",
            labelDashboard: "ğŸ§¦ ë‚˜ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì–‘ë§ (ìˆ˜ìµ)",
            labelMyWishes: "ë‚´ê°€ ë¹ˆ ì†Œì› ìˆ˜",
            labelMyDividends: "ì–‘ë§ ì† ë°°ë‹¹ê¸ˆ (CRO)",
            withdrawBtn: "ğŸ’° ë°°ë‹¹ê¸ˆ ì£¼ë¨¸ë‹ˆì— ë„£ê¸° (ì²­êµ¬)",
            xmasTitle: "ğŸ„ ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤! ì„œí”„ë¼ì´ì¦ˆ íƒ€ì„!",
            xmasDesc: "ì‚°íƒ€ê°€ ì„ ë¬¼ ìƒìë¥¼ ê°•ì œë¡œ ì—´ì—ˆìŠµë‹ˆë‹¤! ì°¸ê°€ì ì „ì›ì—ê²Œ ì„ ë¬¼ ì¦ì •!",
            xmasYourGift: "ë‹¹ì‹ ì˜ ì „ìš© í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì„¸ë±ƒëˆ:",
            claimXmasBtn: "ğŸ Step 2: ì§€ê¸ˆ ì„¸ë±ƒëˆ ì—´ê¸°",
            labelProtocol: "ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í”„ë¡œí† ì½œ ì¹´ìš´íŠ¸ë‹¤ìš´",
            labelProtocolDesc: "ê²Œì„ì´ ê³„ì†ë˜ë©´ 12/26 12:00 UTCì— ì‚°íƒ€ê°€ ê°•ì œ ë°°ë‹¹ì„ ì§„í–‰í•©ë‹ˆë‹¤!",
            labelHistory: "ğŸ“œ ì§€ë‚œ ìš°ìŠ¹ì (History)",
            thRound: "ë¼ìš´ë“œ",
            thWinner: "ìš°ìŠ¹ì",
            thWishes: "ì†Œì› ìˆ˜",
            thPrize: "íšë“ ìƒê¸ˆ",
            tagWinner: "ì­íŒŸ",
            tagProtocol: "í”„ë¡œí† ì½œ",
            noHistory: "ê¸°ë¡ ì—†ìŒ",
            labelContract: "í™•ì¸ëœ ê³„ì•½:",
            linkContract: "CronosScanì—ì„œ ë³´ê¸°",
            labelWhitepaper: "ë°±ì„œ:",
            linkWhitepaper: "ë¬¸ì„œ ì½ê¸°",
            alertNoWallet: "í˜¸í˜¸í˜¸! ì‚°íƒ€ê°€ ì§€ê°‘ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. MetaMaskë¥¼ ì„¤ì¹˜í•´ì£¼ì„¸ìš”!",
            alertWrongChain: "í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì´ë²¤íŠ¸ì— ì°¸ì—¬í•˜ë ¤ë©´ Cronos ë©”ì¸ë„·ìœ¼ë¡œ ì „í™˜í•´ì£¼ì„¸ìš”!",
            timerCalculating: "00:00:00 (ì‚°íƒ€ê°€ ì§‘ê³„ ì¤‘...)",
            btnWishing: "ğŸ… ì‚°íƒ€ê°€ ëª…ë‹¨ í™•ì¸ ì¤‘...",
            alertWishSuccess: "í˜¸í˜¸í˜¸! ì†Œì›ì´ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤! í–‰ìš´ì„ ë¹•ë‹ˆë‹¤!",
            alertWishFail: "ì†Œì› ë¹Œê¸° ì‹¤íŒ¨: ",
            alertCooldown: "ì‚°íƒ€ê°€ ë§í•©ë‹ˆë‹¤: ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” (ì¿¨íƒ€ì„ ì¤‘)!",
            btnWithdrawing: "í¬ì¥ ì¤‘...",
            alertWithdrawSuccess: "ğŸ’° ì§•ê¸€ë²¨! ë°°ë‹¹ê¸ˆì´ ì§€ê°‘ì— ë“¤ì–´ì™”ìŠµë‹ˆë‹¤!",
            alertWithdrawFail: "ì²­êµ¬ ì‹¤íŒ¨, ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
            btnClaimingXmas: "ì„ ë¬¼ ê°œë´‰ ì¤‘...",
            alertClaimXmasSuccess: "ğŸ„ ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤! í° ì„¸ë±ƒëˆì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤!",
            htmlClaimXmasDone: "<h2 style='color:var(--xmas-gold)'>âœ… ì„ ë¬¼ ìˆ˜ë ¹ ì™„ë£Œ! ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤!</h2>",
            alertClaimXmasFail: "ìˆ˜ë ¹ ì‹¤íŒ¨. ì´ë¯¸ ì—´ì–´ë³´ì§€ ì•Šìœ¼ì…¨ë‚˜ìš”?",
            protocolReady: "ğŸ‰ í”„ë¡œí† ì½œ ì¤€ë¹„ ì™„ë£Œ!",
            labelLegacy: "ğŸ´â€â˜ ï¸ ë¯¸ì²­êµ¬ ë°°ë‹¹ê¸ˆ (Unclaimed)",
            btnClaimOld: "ì²­êµ¬"
        }
    };

    var currentLang = 'zh';

    function changeLanguage(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('btn-' + lang).classList.add('active');

        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (translations[lang][key]) {
                element.innerHTML = translations[lang][key];
            }
        });

        updateWishButtonState();
        
        const withdrawBtn = document.getElementById('withdraw-btn');
        if (withdrawBtn.disabled && withdrawBtn.innerText.includes('...')) {
             withdrawBtn.innerText = translations[lang].btnWithdrawing;
        }
        
        if (gameContract) {
             updateHistory(currentRoundId);
             if(userAddress) checkLegacyDividends(userAddress);
        }
    }

    const browserLang = navigator.language || navigator.userLanguage;
    if (browserLang.startsWith('ja')) changeLanguage('ja');
    else if (browserLang.startsWith('ko')) changeLanguage('ko');
    else if (browserLang.startsWith('en')) changeLanguage('en');
    else changeLanguage('zh'); 

    // --- Config ---
    var CONTRACT_ADDR = "0xdc5240423601D7FB443b0062e22Aa08d43B6A0c1"; 
    var EXPLORER_URL = "https://cronoscan.com/address/" + CONTRACT_ADDR;
    // æ‚¨çš„åˆç´„æ™‚é–“è¨­å®š (è«‹ç¢ºä¿é€™è·Ÿåˆç´„è¨­å®šçš„ä¸€è‡´ï¼Œå¦‚æœæ˜¯ 2024 å¹´å‰‡ç‚º 1735214400)
    var CHRISTMAS_TIMESTAMP_STATIC = 1766750400; 

    // ABI
    var ABI = [
        "function wish() external payable",
        "function withdrawDividends(uint256 _rId) external",
        "function claimChristmasGift(uint256 _rId) external",
        "function triggerChristmasProtocol() external",
        "function grandPot() view returns (uint256)",
        "function roundId() view returns (uint256)",
        "function rounds(uint256) view returns (bool, bool, bool, uint256, uint256, address, uint256, uint256)",
        "function wishers(uint256, address) view returns (uint256, uint256, uint256, uint256, bool)",
        "function getPendingDividends(uint256, address) view returns (uint256)",
        "function getPendingChristmasGift(uint256, address) view returns (uint256)",
        "function CHRISTMAS_END_TIMESTAMP() view returns (uint256)"
    ];

    // Variables
    var gameProvider = null;
    var gameSigner = null;
    var gameContract = null;
    var userAddress = null;
    var currentRoundId = 1;
    var currentLeader = null;
    var countdownInterval;
    var protocolInterval;

    document.getElementById('contract-link').href = EXPLORER_URL;

    startProtocolCountdown();
    
    // Check Ethers on Load
    window.addEventListener('load', function() {
        if (typeof ethers === 'undefined') {
            console.error("Ethers.js failed to load");
            alert("âš ï¸ éŒ¯èª¤ï¼šæ ¸å¿ƒæª”æ¡ˆåŠ è¼‰å¤±æ•—ï¼\nè«‹å˜—è©¦ï¼š\n1. é‡æ–°æ•´ç†ç¶²é \n2. é—œé–‰ AdBlock");
        }
    });

    async function connectWallet() {
        console.log("Connect Wallet Triggered");
        if (!window.ethereum) { 
            alert(translations[currentLang].alertNoWallet); 
            return; 
        }
        
        try {
            // Ethers v5 Provider
            gameProvider = new ethers.providers.Web3Provider(window.ethereum);
            console.log("Provider created");
            
            await gameProvider.send("eth_requestAccounts", []);
            console.log("Accounts requested");
            
            gameSigner = gameProvider.getSigner();
            userAddress = await gameSigner.getAddress();
            console.log("Address:", userAddress);
            
            gameContract = new ethers.Contract(CONTRACT_ADDR, ABI, gameSigner);

            // UI Updates
            document.getElementById('connect-btn').classList.add('hidden');
            document.getElementById('wallet-info').classList.remove('hidden');
            document.getElementById('wallet-address').innerText = userAddress.slice(0,6) + "..." + userAddress.slice(-4);
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('history-card').classList.remove('hidden');

            const network = await gameProvider.getNetwork();
            if (network.chainId !== 25) {
                try {
                    await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x19' }] });
                } catch (err) { alert(translations[currentLang].alertWrongChain); }
            }

            refreshData();
            setInterval(refreshData, 5000); 

        } catch (error) {
            console.error("Connection Error:", error);
            alert("é€£æ¥å¤±æ•— (Connection Error):\n" + (error.reason || error.message || error));
        }
    }

    async function refreshData() {
        if (!gameContract) return;
        try {
            var rId = await gameContract.roundId();
            currentRoundId = rId.toNumber();
            
            var pot = await gameContract.grandPot();
            var roundData = await gameContract.rounds(currentRoundId);
            var christmasEnded = roundData[2];
            var endTimestamp = roundData[3].toNumber();
            var totalWishes = roundData[4].toNumber();
            var leader = roundData[5]; 
            
            currentLeader = leader; 

            document.getElementById('grand-pot').innerText = ethers.utils.formatEther(pot) + " CRO";
            
            var leaderDisplay = (leader === "0x0000000000000000000000000000000000000000") ? "---" : leader.slice(0, 6) + "..." + leader.slice(-4);
            if (userAddress && leader.toLowerCase() === userAddress.toLowerCase()) {
                leaderDisplay += " (You ğŸ‘‘)";
            }
            document.getElementById('current-leader').innerText = leaderDisplay;

            updateWishButtonState();

            // ç‹€æ…‹ 1: è–èª•å”è­°å·²ç”Ÿæ•ˆ -> é¡¯ç¤ºé ˜å–ç•«é¢ï¼Œéš±è—å…¶ä»–
            if (christmasEnded) {
                document.getElementById('game-card').classList.add('hidden');
                document.getElementById('protocol-card').classList.add('hidden'); // éš±è—è§¸ç™¼æŒ‰éˆ•
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('christmas-card').classList.remove('hidden'); // é¡¯ç¤ºé ˜å–æŒ‰éˆ•
                
                if (userAddress) {
                    var gift = await gameContract.getPendingChristmasGift(currentRoundId, userAddress);
                    document.getElementById('christmas-gift-amount').innerText = ethers.utils.formatEther(gift) + " CRO";
                }
            } 
            // ç‹€æ…‹ 2: è–èª•å”è­°æœªç”Ÿæ•ˆï¼Œä½†éŠæˆ²æ­£å¸¸é€²è¡Œ
            else {
                document.getElementById('game-card').classList.remove('hidden');
                document.getElementById('christmas-card').classList.add('hidden');
                
                if (totalWishes < 100) {
                    document.getElementById('timer-section').classList.add('hidden');
                    document.getElementById('warmup-section').classList.remove('hidden');
                    document.getElementById('warmup-count').innerText = totalWishes;
                } else {
                    document.getElementById('warmup-section').classList.add('hidden');
                    document.getElementById('timer-section').classList.remove('hidden');
                    startCountdown(endTimestamp);
                }
                
                // æª¢æŸ¥æ˜¯å¦é¡¯ç¤ºã€Œè§¸ç™¼ã€æŒ‰éˆ• (åªæœ‰åœ¨æ™‚é–“åˆ°ä¸”é‚„æ²’çµæŸæ™‚é¡¯ç¤º)
                document.getElementById('protocol-card').classList.remove('hidden');
                if (userAddress) {
                    var pendingDivs = await gameContract.getPendingDividends(currentRoundId, userAddress);
                    var wisherInfo = await gameContract.wishers(currentRoundId, userAddress);
                    document.getElementById('my-dividends').innerText = parseFloat(ethers.utils.formatEther(pendingDivs)).toFixed(4);
                    document.getElementById('my-wishes').innerText = wisherInfo[1].toString();
                }
            }

            updateHistory(currentRoundId);
            if (userAddress) checkLegacyDividends(userAddress);

        } catch (err) { console.error("Error fetching data:", err); }
    }

    function updateWishButtonState() {
        if (!userAddress || !currentLeader) return;
        
        var btn = document.getElementById('wish-btn');
        if (currentLeader.toLowerCase() === userAddress.toLowerCase()) {
            btn.innerText = translations[currentLang].btnYouAreLeading;
            btn.classList.add('btn-leading');
        } else {
            if (!btn.disabled || btn.innerText === translations[currentLang].btnYouAreLeading) {
                btn.innerText = translations[currentLang].wishBtn;
                btn.classList.remove('btn-leading');
            }
        }
    }

    async function checkLegacyDividends(user) {
        if (currentRoundId <= 1) return;
        
        var html = ``;
        var hasClaims = false;

        for (var i = 1; i < currentRoundId; i++) {
            try {
                var pending = await gameContract.getPendingDividends(i, user);
                if (pending.gt(0)) {
                    hasClaims = true;
                    html += `
                        <div class="legacy-row">
                            <span>Round #${i}: <span style="color:var(--xmas-green)">${parseFloat(ethers.utils.formatEther(pending)).toFixed(2)} CRO</span></span>
                            <button class="btn btn-sm" onclick="withdrawOld(${i})">${translations[currentLang].btnClaimOld}</button>
                        </div>
                    `;
                }
            } catch (e) {}
        }

        var container = document.getElementById('legacy-claims');
        if (hasClaims) {
            container.innerHTML = `<div class="legacy-box"><div style="font-weight:bold;margin-bottom:5px;">${translations[currentLang].labelLegacy}</div>${html}</div>`;
            container.classList.remove('hidden');
        } else {
            container.classList.add('hidden');
        }
    }

    async function withdrawOld(rId) {
        if (!gameContract) return;
        try {
            var tx = await gameContract.withdrawDividends(rId, { gasLimit: 200000 });
            await tx.wait();
            alert("ğŸ’° Success! Old dividends claimed.");
            refreshData();
        } catch (err) { alert("Error claiming old dividends."); }
    }

    async function updateHistory(currentId) {
        if (currentId <= 1) {
            document.getElementById('history-list').innerHTML = `<tr><td colspan="4" style="text-align:center; color:#888;">${translations[currentLang].noHistory}</td></tr>`;
            return;
        }

        var html = '';
        for (var i = currentId - 1; i >= 1; i--) {
            try {
                var rData = await gameContract.rounds(i);
                var ended = rData[1];
                var xmasEnded = rData[2];
                var totalWishes = rData[4].toNumber();
                var winner = rData[5];

                var winnerDisplay = "---";
                var resultTag = "";
                
                var calcPrize = (totalWishes * 12.8).toFixed(2) + " CRO";

                if (xmasEnded) {
                    winnerDisplay = "ğŸ… Santa (All)";
                    resultTag = `<span class="protocol-tag">${translations[currentLang].tagProtocol}</span>`;
                    calcPrize = "50% Pool"; 
                } else if (ended) {
                    winnerDisplay = winner.slice(0, 6) + "..." + winner.slice(-4);
                    resultTag = `<span class="winner-tag">${translations[currentLang].tagWinner}</span>`;
                } else {
                    calcPrize = "Running...";
                }

                html += `
                    <tr>
                        <td>#${i}</td>
                        <td style="font-family:monospace; color:#fff;">${winnerDisplay}</td>
                        <td>${totalWishes}</td>
                        <td style="color:var(--xmas-gold); font-weight:bold;">${calcPrize}</td>
                    </tr>
                `;
            } catch (e) { console.log(e); }
        }
        document.getElementById('history-list').innerHTML = html;
    }

    function startCountdown(endTime) {
        if (countdownInterval) clearInterval(countdownInterval);
        countdownInterval = setInterval(() => {
            var now = Math.floor(Date.now() / 1000);
            var diff = endTime - now;
            var timerEl = document.getElementById('timer');
            if (diff <= 0) {
                timerEl.innerText = translations[currentLang].timerCalculating;
                timerEl.style.backgroundColor = "#5a0b0f";
            } else {
                var h = Math.floor(diff / 3600);
                var m = Math.floor((diff % 3600) / 60);
                var s = diff % 60;
                timerEl.innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                timerEl.style.backgroundColor = diff < 60 ? "#c30f16" : "rgba(195, 15, 22, 0.6)";
            }
        }, 1000);
    }

    // æ›´æ–°å¾Œçš„è–èª•å”è­°å€’æ•¸èˆ‡æŒ‰éˆ•æ§åˆ¶
    function startProtocolCountdown() {
        if (protocolInterval) clearInterval(protocolInterval);
        
        protocolInterval = setInterval(() => {
            var now = Math.floor(Date.now() / 1000);
            var diff = CHRISTMAS_TIMESTAMP_STATIC - now;
            var timerEl = document.getElementById('protocol-timer');
            var actionArea = document.getElementById('protocol-action-area');
            
            if (diff <= 0) {
                // æ™‚é–“åˆ°äº†ï¼
                timerEl.innerText = translations[currentLang].protocolReady;
                // æ³¨æ„ï¼šé€™è£¡åªæª¢æŸ¥æ™‚é–“æ˜¯å¦åˆ°ï¼ŒçœŸæ­£æ˜¯å¦é¡¯ç¤ºæŒ‰éˆ•ç”± refreshData() çš„ christmasEnded ç‹€æ…‹æ±ºå®š
                // é˜²æ­¢å·²ç¶“çµæŸäº†é‚„é¡¯ç¤ºè§¸ç™¼æŒ‰éˆ•
                if (actionArea.classList.contains('hidden') && !document.getElementById('christmas-card').classList.contains('hidden') === false) {
                     // åªæœ‰ç•¶ Christmas Card æ˜¯éš±è—çš„ (ä»£è¡¨é‚„æ²’çµæŸ)ï¼Œæ‰é¡¯ç¤ºè§¸ç™¼æŒ‰éˆ•
                     actionArea.classList.remove('hidden');
                }
            } else {
                // æ™‚é–“é‚„æ²’åˆ°
                actionArea.classList.add('hidden');
                
                var d = Math.floor(diff / 86400);
                var h = Math.floor((diff % 86400) / 3600);
                var m = Math.floor((diff % 3600) / 60);
                var s = diff % 60;
                timerEl.innerText = `${d}d ${h.toString().padStart(2,'0')}h ${m.toString().padStart(2,'0')}m ${s.toString().padStart(2,'0')}s`;
            }
        }, 1000);
    }

    // æ­¥é©Ÿ1ï¼šè§¸ç™¼è–èª•å”è­° (åªéœ€ä¸€äººåŸ·è¡Œ)
    async function triggerProtocol() {
        if (!gameContract) return;
        
        // å†æ¬¡ç¢ºèªæ™‚é–“
        const now = Math.floor(Date.now() / 1000);
        if (now < CHRISTMAS_TIMESTAMP_STATIC) {
            alert("â³ æ™‚é–“é‚„æ²’åˆ°å–”ï¼(Wait for the time)");
            return;
        }

        const btn = event.target;
        try {
            btn.disabled = true;
            btn.innerText = "âš¡ è§¸ç™¼çµç®—ä¸­ (Triggering)...";
            
            // å‘¼å«åˆç´„: gasLimit 250è¬
            const tx = await gameContract.triggerChristmasProtocol({ gasLimit: 2500000 });
            console.log("Tx sent:", tx.hash);
            await tx.wait();
            
            alert("ğŸ‰ è–èª•å”è­°å·²å•Ÿå‹•ï¼ç•«é¢å°‡åˆ‡æ›ç‚ºã€Œé ˜å–æ¨¡å¼ã€ã€‚");
            window.location.reload(); // é‡æ–°æ•´ç†å¾Œï¼ŒrefreshData æœƒåµæ¸¬åˆ°ç‹€æ…‹æ”¹è®Šï¼Œè‡ªå‹•åˆ‡æ›ä»‹é¢
        } catch (err) {
            console.error(err);
            alert("è§¸ç™¼å¤±æ•— (Failed): " + (err.reason || err.message));
            btn.disabled = false;
            btn.innerText = "ğŸ… æ­¥é©Ÿä¸€ï¼šé–‹å•Ÿè–èª•å”è­° (åªéœ€ä¸€äººé»æ“Š)";
        }
    }

    async function makeWish() {
        if (userAddress && currentLeader && userAddress.toLowerCase() === currentLeader.toLowerCase()) {
            if (!confirm("âš ï¸ ä½ ç›®å‰å·²ç¶“æ˜¯é ˜å…ˆè€…äº† (You are already winning)ï¼\nå†æ¬¡è¨±é¡˜åªæœƒå»¶é•·æ™‚é–“ï¼Œä¸æœƒå¢åŠ ç²å‹æ©Ÿç‡ã€‚\nç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ")) {
                return;
            }
        }

        if (!gameContract) return;
        var btn = document.getElementById('wish-btn');
        try {
            btn.disabled = true;
            btn.innerText = translations[currentLang].btnWishing;
            var tx = await gameContract.wish({ value: ethers.utils.parseEther("20"), gasLimit: 300000 });
            await tx.wait();
            alert(translations[currentLang].alertWishSuccess);
            refreshData();
        } catch (err) {
            console.error(err);
            var msg = err.reason || err.message;
            if (msg.includes("Cooldown")) msg = translations[currentLang].alertCooldown;
            alert(translations[currentLang].alertWishFail + msg);
        } finally {
            btn.disabled = false;
        }
    }

    async function withdraw() {
        if (!gameContract) return;
        var btn = document.getElementById('withdraw-btn');
        try {
            btn.disabled = true;
            btn.innerText = translations[currentLang].btnWithdrawing;
            var tx = await gameContract.withdrawDividends(currentRoundId, { gasLimit: 200000 });
            await tx.wait();
            alert(translations[currentLang].alertWithdrawSuccess);
            refreshData();
        } catch (err) {
            console.error(err);
            alert(translations[currentLang].alertWithdrawFail);
        } finally {
            btn.disabled = false;
            btn.innerText = translations[currentLang].withdrawBtn;
        }
    }

    // æ­¥é©Ÿ2ï¼šé ˜å–è–èª•ç¦®ç‰© (æ‰€æœ‰äºº)
    async function claimChristmas() {
        if (!gameContract) return;
        var btn = event.target;
        try {
            btn.disabled = true;
            btn.innerText = translations[currentLang].btnClaimingXmas;
            // å‘¼å« claimChristmasGift
            var tx = await gameContract.claimChristmasGift(currentRoundId);
            await tx.wait();
            alert(translations[currentLang].alertClaimXmasSuccess);
            document.getElementById('christmas-card').innerHTML = translations[currentLang].htmlClaimXmasDone;
        } catch (err) {
            console.error(err);
            alert(translations[currentLang].alertClaimXmasFail);
            btn.disabled = false;
            btn.innerText = translations[currentLang].claimXmasBtn;
        }
    }
</script>
</body>
</html>








